{% extends "taskrabbit/base.html" %}
{% block title %}{{ team.name }} Tasks{% endblock %}

{% block main_content %}
    <div class="row">
        <div class="col-lg-12">
            <h1>Tasks for {{ team.name }} Team</h1>

            <table class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Owner</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody>
                {% for task in tasks %}
                    <tr>
                        <td>{{ task.name }}</td>
                        <td>{% if task.owner %}{{ task.owner.first_name }}{% else %}<i>None</i>
                            <a href="#" onclick="confirmClaim({{ task.id }}); return false;">(claim task)</a>{% endif %}</td>
                        <td>{{ task.status }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <script type="text/javascript">
        function confirmClaim(id) {
            if(confirm("Are you sure you want to claim this task?")) {
                $.ajax({
                    url: "{% url 'taskrabbit:claim_task' %}",
                    data: {
                        'csrfmiddlewaretoken': $.cookie('csrftoken'),
                        'task_id': id
                    },
                    type: "POST",
                    success: function() {
                        window.location = "{% url 'taskrabbit:index' %}";
                    }
                });
            }
        }
    </script>
{% endblock %}